(()=>{"use strict";class e{constructor(){this.aiTellPhrases=["it's worth noting","it is worth noting","a testament to","game-changer","game changer","delve into","tapestry","multifaceted","in today's world","in the realm of","navigating the","stands out as","it should be noted","in this regard","underscores","fostering","holistic","elevate the","elevates the","truly remarkable","new heights","commitment to excellence","user experience","attention to detail is","works flawlessly","couldn't be happier","changed my daily routine","both elegant and practical"],this.hypeWords=["amazing","incredible","fantastic","exceptional","remarkable","outstanding","unbeatable","flawlessly","truly","absolutely","every way","everyone","definitely","certainly"],this.fakeReviewTemplates=["i bought this for my","i purchased this for","my husband/wife loves","exactly as described","exactly what i needed","highly recommend this product","five stars all the way","exceeded my expectations","i was skeptical at first but","worth every penny","great quality for the price","you won't be disappointed","must have product","i've tried many similar products","this is by far the best","don't hesitate to buy","arrived quickly and well packaged"]}analyze(e){if(!e||e.length<20)return{aiDetection:null,repetitionPattern:null,sentimentConsistency:null,vocabularyDistribution:null,templateMatching:null};const t=e.toLowerCase().trim();return{aiDetection:this._detectAIPatterns(t),repetitionPattern:this._analyzeRepetition(t),sentimentConsistency:this._analyzeSentiment(t),vocabularyDistribution:this._analyzeVocabulary(t),templateMatching:this._detectTemplates(t)}}_detectAIPatterns(e){let t=0;const s=[];for(const n of this.aiTellPhrases){const i=new RegExp(n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),a=e.match(i);a&&(t+=a.length,s.push(n))}const n=t/(e.length/500);let i=0;for(const t of this.hypeWords){const s=new RegExp("\\b"+t+"\\b","gi"),n=e.match(s);n&&(i+=n.length)}const a=i/(e.length/500);let o=1;return t>0&&(o-=Math.min(.5,.25*n)),a>3&&(o-=Math.min(.4,.1*(a-2))),o=Math.max(0,Math.min(1,o)),{score:o,detail:s.length>0||i>3?`Found ${t} AI-associated phrases, ${i} hype words`:null}}_analyzeRepetition(e){const t=e.split(/[.!?]+/).filter(e=>e.trim().length>10);if(t.length<2)return{score:.5,detail:null};const s=this._extractNgrams(e,3),n={};for(const e of s)n[e]=(n[e]||0)+1;const i=Object.values(n).filter(e=>e>2).length,a=i/Math.max(1,s.length),o=t.map(e=>e.trim().split(/\s+/).slice(0,3).join(" ")),l=new Set(o).size/o.length;let r=0;const c=t.reduce((e,t)=>e+t.trim().split(/\s+/).length,0)/t.length;t.reduce((e,t)=>{const s=t.trim().split(/\s+/).length;return e+Math.pow(s-c,2)},0)/t.length<8&&t.length>=3&&(r=.3);const h=["because","since","so","which","where","when","after","before","while","then"];let d=0;for(const t of e.split(/\s+/))h.includes(t.toLowerCase().replace(/[^a-z]/g,""))&&d++;0===d&&t.length>=4&&(r+=.2);let u=1;return u-=.3*(1-l),u-=Math.min(.3,50*a*.3),u-=r,{score:Math.max(0,Math.min(1,u)),detail:u<.5?`Formulaic structure detected: ${i} repeated phrases, low sentence variation`:null}}_analyzeSentiment(e){const t=["great","amazing","excellent","perfect","love","best","wonderful","fantastic","awesome","incredible","superb","outstanding","brilliant","magnificent","terrific","fabulous","happy","recommend"],s=["bad","terrible","awful","worst","hate","horrible","poor","disappointing","broken","waste","junk","useless","defective","cheap","flimsy","garbage"],n=["but","however","although","though","except","unless","somewhat","slightly","minor","small issue","only complaint","downside","only","wish","could be","not perfect"],i=[/\d+\s*(inch|mm|cm|lb|kg|oz|gb|mb|watt|hour|day|week|month|minute)/i,/\d+\/\d+/,/\$\d+/,/[A-Z][a-z]+ [A-Z]/,/my (wife|husband|son|daughter|mom|dad|friend|sister|brother|kid)/i],a=e.split(/\s+/),o=a.length;let l=0,r=0,c=0;for(const e of a){const i=e.replace(/[^a-z]/g,"");t.includes(i)&&l++,s.includes(i)&&r++,n.includes(i)&&c++}const h=l/o;let d=0;for(const t of i)t.test(e)&&d++;return h>.06&&0===c&&0===r&&0===d?{score:.15,detail:"Uniformly positive with no nuance or specific details"}:h>.08&&0===d?{score:.3,detail:"Very high praise density without concrete details"}:h>.06&&0===c&&0===r&&d>0?{score:.45,detail:"Positive without hedging but contains specific details"}:c>0||l>0&&r>0?{score:.85,detail:null}:{score:.6,detail:null}}_analyzeVocabulary(e){const t=e.split(/\s+/).map(e=>e.replace(/[^a-z]/g,"")).filter(e=>e.length>2);if(t.length<20)return{score:.5,detail:null};const s=new Set(t).size/t.length,n=new Set(["product","item","thing","purchase","quality","price","everything","everyone","anyone","nothing","something","ever","always","never","every","very","really","just","amazing","great","good","nice","best","love","happy"]);let i=0;for(const e of t)n.has(e)&&i++;const a=i/t.length;let o;o=s>.85&&t.length>100?.5:s<.3?.35:.7+.2*s,a>.2?o-=.35:a>.15&&(o-=.2);const l=t.reduce((e,t)=>e+t.length,0)/t.length;return t.reduce((e,t)=>e+Math.pow(t.length-l,2),0)/t.length<3&&(o*=.8),{score:Math.max(0,Math.min(1,o)),detail:o<.4?`Vocabulary lacks specificity (${Math.round(100*a)}% generic words)`:null}}_detectTemplates(e){let t=0;const s=[];for(const n of this.fakeReviewTemplates)e.includes(n)&&(t++,s.push(n));return{score:Math.max(0,1-.3*t),detail:t>0?`Matched ${t} common fake review template phrase${t>1?"s":""}`:null}}_extractNgrams(e,t){const s=e.split(/\s+/).filter(e=>e.length>0),n=[];for(let e=0;e<=s.length-t;e++)n.push(s.slice(e,e+t).join(" "));return n}}class t{constructor(e={}){this.weights={text:{aiDetection:.25,repetitionPattern:.2,sentimentConsistency:.15,vocabularyDistribution:.15,templateMatching:.25},account:{accountAge:.3,postingFrequency:.25,reviewDiversity:.2,profileCompleteness:.15,networkConnections:.1},behavioral:{timingCluster:.35,coordinatedLanguage:.35,ratingDistribution:.3},media:{reverseImageMatch:.4,exifAnalysis:.25,aiArtifacts:.35}},this.categoryWeights={text:.3,account:.25,behavioral:.3,media:.15},this.thresholds={HIGH_TRUST:.75,MODERATE_TRUST:.5,LOW_TRUST:.3,VERY_LOW_TRUST:.15},this.config={minSignalsRequired:3,confidenceDecay:.85,...e}}computeScore(e){const t={},n=[];let i=0;for(const[s,a]of Object.entries(e)){if(!this.weights[s])continue;const e=this._scoreCatgory(s,a,this.weights[s]);e.signalCount>0&&(t[s]=e,i+=e.signalCount,n.push(...e.issues))}if(i<this.config.minSignalsRequired)return new s({score:null,level:"INSUFFICIENT_DATA",confidence:0,message:"Not enough data to assess authenticity",details:t,issues:[],signalCount:i});let a=0,o=0;for(const[e,s]of Object.entries(t)){const t=this.categoryWeights[e]||0;a+=s.score*t,o+=t}a=o>0?a/o:.5;const l=i/10,r=Math.min(1,l)*this.config.confidenceDecay,c=this._getTrustLevel(a),h=this._generateMessage(c,n,r);return new s({score:a,level:c,confidence:r,message:h,details:t,issues:n,signalCount:i})}_scoreCatgory(e,t,s){let n=0,i=0,a=0;const o=[];for(const[l,r]of Object.entries(t)){if(null==r)continue;const t=s[l]||0,c="object"==typeof r?r.score:r;null!=c&&(n+=c*t,i+=t,a++,c<.4&&o.push({category:e,signal:l,score:c,detail:"object"==typeof r?r.detail:null,severity:c<.2?"high":"medium"}))}return{score:i>0?n/i:.5,signalCount:a,issues:o}}_getTrustLevel(e){return e>=this.thresholds.HIGH_TRUST?"HIGH_TRUST":e>=this.thresholds.MODERATE_TRUST?"MODERATE_TRUST":e>=this.thresholds.LOW_TRUST?"LOW_TRUST":"VERY_LOW_TRUST"}_generateMessage(e,t,s){const n=s<.5?"Limited data suggests":"",i={HIGH_TRUST:"This content appears authentic based on available signals.",MODERATE_TRUST:`Mixed signals detected. ${t.length} potential concern${1!==t.length?"s":""} found.`,LOW_TRUST:`Multiple markers suggest this content may not be authentic. ${t.length} concern${1!==t.length?"s":""} flagged.`,VERY_LOW_TRUST:`Strong indicators of inauthentic content detected. ${t.length} significant concern${1!==t.length?"s":""} found.`}[e]||"Unable to assess.";return n?`${n}: ${i}`:i}}class s{constructor({score:e,level:t,confidence:s,message:n,details:i,issues:a,signalCount:o}){this.score=e,this.level=t,this.confidence=s,this.message=n,this.details=i,this.issues=a,this.signalCount=o,this.timestamp=Date.now(),Object.freeze(this)}get color(){return{HIGH_TRUST:"#22c55e",MODERATE_TRUST:"#eab308",LOW_TRUST:"#f97316",VERY_LOW_TRUST:"#ef4444",INSUFFICIENT_DATA:"#6b7280"}[this.level]||"#6b7280"}get icon(){return{HIGH_TRUST:"✓",MODERATE_TRUST:"⚠",LOW_TRUST:"⚠",VERY_LOW_TRUST:"✕",INSUFFICIENT_DATA:"?"}[this.level]||"?"}toJSON(){return{score:this.score,level:this.level,confidence:this.confidence,message:this.message,issues:this.issues,signalCount:this.signalCount,timestamp:this.timestamp}}}class n{constructor(){this.namespace="did",this.initialized=!1}renderProductBadge(e,t){const s=document.querySelector(`.${this.namespace}-product-badge`);s&&s.remove();const n=document.createElement("div");n.className=`${this.namespace}-product-badge`,n.setAttribute("data-trust-level",e.level),n.innerHTML=`\n      <div class="${this.namespace}-badge-compact">\n        <span class="${this.namespace}-badge-icon" style="color: ${e.color}">\n          ${e.icon}\n        </span>\n        <span class="${this.namespace}-badge-label">\n          Review Authenticity: <strong>${this._getLevelLabel(e.level)}</strong>\n        </span>\n        <span class="${this.namespace}-badge-score">\n          ${null!==e.score?Math.round(100*e.score)+"%":"—"}\n        </span>\n        <button class="${this.namespace}-badge-expand" aria-label="Show details">▾</button>\n      </div>\n      <div class="${this.namespace}-badge-details" style="display: none;">\n        <div class="${this.namespace}-badge-message">${e.message}</div>\n        ${this._renderIssuesList(e.issues)}\n        <div class="${this.namespace}-badge-meta">\n          Based on ${e.signalCount} analysis signals · \n          Confidence: ${Math.round(100*(e.confidence||0))}%\n        </div>\n        <div class="${this.namespace}-badge-disclaimer">\n          Dead Internet Detector provides indicators, not definitive judgments. \n          Use your own judgment alongside these signals.\n        </div>\n      </div>\n    `;const i=n.querySelector(`.${this.namespace}-badge-expand`),a=n.querySelector(`.${this.namespace}-badge-details`);i.addEventListener("click",()=>{const e="none"===a.style.display;a.style.display=e?"block":"none",i.textContent=e?"▴":"▾"});const o=document.querySelector("#cm-cr-dp-review-list")||document.querySelector("#reviews-medley-footer");o?o.parentNode.insertBefore(n,o):document.body.appendChild(n)}renderReviewBadge(e,t){if(!t)return;if(t.querySelector(`.${this.namespace}-review-badge`))return;const s=document.createElement("div");s.className=`${this.namespace}-review-badge`,s.setAttribute("data-trust-level",e.level);const n=null!==e.score?Math.round(100*e.score)+"%":"?";s.innerHTML=`\n      <span class="${this.namespace}-review-indicator" \n            style="background-color: ${e.color}"\n            title="${e.message}">\n        ${e.icon} ${n}\n      </span>\n    `;const i=document.createElement("div");i.className=`${this.namespace}-review-tooltip`,i.innerHTML=`\n      <div class="${this.namespace}-tooltip-title">\n        Authenticity Score: ${n}\n      </div>\n      <div class="${this.namespace}-tooltip-message">${e.message}</div>\n      ${e.issues.length>0?`\n        <ul class="${this.namespace}-tooltip-issues">\n          ${e.issues.slice(0,3).map(e=>`\n            <li class="${this.namespace}-tooltip-issue ${this.namespace}-severity-${e.severity}">\n              ${e.detail||this._formatSignalName(e.signal)}\n            </li>\n          `).join("")}\n        </ul>\n      `:""}\n    `,s.appendChild(i);const a=s.querySelector(`.${this.namespace}-review-indicator`);a.addEventListener("mouseenter",()=>{i.style.display="block"}),a.addEventListener("mouseleave",()=>{i.style.display="none"}),t.style.position="relative",t.insertBefore(s,t.firstChild)}_getLevelLabel(e){return{HIGH_TRUST:"Likely Authentic",MODERATE_TRUST:"Mixed Signals",LOW_TRUST:"Questionable",VERY_LOW_TRUST:"Likely Inauthentic",INSUFFICIENT_DATA:"Insufficient Data"}[e]||"Unknown"}_renderIssuesList(e){return e&&0!==e.length?`\n      <ul class="${this.namespace}-issues-list">\n        ${e.map(e=>`\n          <li class="${this.namespace}-issue ${this.namespace}-severity-${e.severity}">\n            <span class="${this.namespace}-issue-category">${this._formatCategory(e.category)}</span>\n            <span class="${this.namespace}-issue-detail">\n              ${e.detail||this._formatSignalName(e.signal)}\n            </span>\n          </li>\n        `).join("")}\n      </ul>\n    `:'<div class="did-no-issues">No specific concerns flagged.</div>'}_formatCategory(e){return{text:"Content",account:"Reviewer",behavioral:"Pattern",media:"Media"}[e]||e}_formatSignalName(e){return e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim()}}(new class{constructor(){this.textAnalyzer=new e,this.trustScorer=new t,this.renderer=new n}async init(){console.log("[DID] Reddit module loaded — analysis coming in Phase 2"),chrome.runtime.sendMessage({type:"PAGE_SCORED",data:{url:window.location.href,score:{score:null,level:"INSUFFICIENT_DATA",message:"Reddit analysis coming soon",issues:[],signalCount:0},platform:"reddit"}})}}).init()})();